import{i as isTemplate,g as getProp,c as copyCtx,d as doNextStepSelect,a as doNextStepSibling,p as processEl,b as processSymbols,r as restoreCtx,t as transform}from"./xtal-editor-fd39068c.js";export{f as templStampPlugin,e as templStampSym}from"./xtal-editor-fd39068c.js";function doTransform(e,t){const o=copyCtx(e);e.Transform=t;const n=Object.keys(t);if(0!==n.length){const t=n[0][0];let r="SNTM".indexOf(t)>-1;e.previousTransform=o.Transform,r?(doNextStepSelect(e),doNextStepSibling(e)):(e.target=e.target.firstElementChild,e.level++,e.idx=0,processEl(e),processSymbols(e)),delete e.previousTransform}restoreCtx(e,o)}function doObjectMatch(e,t,o){if(Array.isArray(t))doArrayMatch(e,t,o);else{if(isTemplate(t))return void doTemplate(o,t);doTransform(o,t)}}function bulkTransfer(e,t){Array.from(e.childNodes).forEach(e=>{t.appendChild(e)})}const twm=Symbol();function doTemplate(e,t){const o=e.target,n=void 0!==t.dataset.shadowRoot;let r=o;const s=t.content.cloneNode(!0);if(n)null===o.shadowRoot?o.attachShadow({mode:t.dataset.shadowRoot,delegatesFocus:!0}):o.shadowRoot.innerHTML="",r=o.shadowRoot,r.appendChild(s);else{const e=Array.from(s.querySelectorAll("slot"));if(e.length>0)e.forEach(e=>{let t=e;if(t.hasAttribute("as-template")){const o=document.createElement("template");t.insertAdjacentElement("afterend",o),t=o,e.remove()}const n=e.name;if(n){const e=o.querySelector(`[slot="${n}"]`);null!==e&&bulkTransfer(e,t)}else bulkTransfer(o,t)}),o.innerHTML="",o.appendChild(s);else{const e=Array.from(o.querySelectorAll("template-content")),n=o;void 0===n[twm]&&(n[twm]=new WeakMap);const r=n[twm],s=r.get(t);if(e.forEach(e=>{void 0===s||e!==s?(e.style.display="none",e.removeAttribute("part")):void 0!==s&&e===s&&(s.style.display="block",e.setAttribute("part","content"))}),void 0===s){const e=document.createElement("template-content");e.style.display="block",e.setAttribute("part","content");const n=t.content.cloneNode(!0);e.appendChild(n),r.set(t,e),o.appendChild(e)}}}}function doArrayMatch(e,t,o){const n=t[0];switch(typeof n){case"undefined":return;case"object":Array.isArray(n)?doRepeat(e,t,o):doPropSetting(e,t,o);break;case"boolean":doCondition(e,t,o);break;case"symbol":o.plugins[n].fn(o,t);break;case"string":const r=o.target,s=t[1];let a;if(void 0!==s)"replace"===s?r.localName!==n&&(a=document.createElement(n),r.getAttributeNames().forEach(e=>{a.setAttribute(e,r.getAttribute(e))}),r.childNodes.forEach(e=>{a.append(e)}),r.dataset.deleteMe="true",r.insertAdjacentElement("afterend",a)):(a=document.createElement(n),r.insertAdjacentElement(s,a));else{const e=document.createElement(n);r.appendChild(e)}const i=t[2];void 0!==i&&void 0!==a&&(o.target=a,doPropSetting(e,i,o),o.target=r)}}function doCondition(e,t,o){const[n,r,s,a]=t,i=n?r:a;if(void 0!==i&&o.target.appendChild(i.content.cloneNode(!0)),void 0!==s){const e=o.host||o;void 0!==s.yesSym&&(n?e[s.yesSym]=o.target:delete e[s.yesSym]),void 0!==s.noSym&&(n?delete e[s.noSym]:e[s.noSym]=o.target),void 0!==s.eitherSym&&(e[s.eitherSym]=o.target)}}function doPropSetting(e,t,o){const n=t.length,r=o.target;if(n>0){{const e=t[0];if(void 0!==e){const t=Object.assign({},e);delete t.dataset,delete t.style,Object.assign(r,t),void 0!==e.style&&Object.assign(r.style,e.style),void 0!==e.dataset&&Object.assign(r.dataset,e.dataset)}}if(n>1){if(void 0!==t[1]){const e=t[1];for(const t in e){let n=e[t];if(Array.isArray(n)){const e=n[1].split("."),t=n[2],r=void 0!==o.host?n[0].bind(o.host):n[0];n=o=>{let n=getProp(o.target,e);void 0!==t&&(n=t(n)),r(n,o)}}else void 0!==o.host&&(n=n.bind(o.host));r.addEventListener(t,n)}}if(n>2){if(void 0!==t[2])for(const e in t[2]){const o=t[2][e];switch(typeof o){case"boolean":o?r.setAttribute(e,""):r.removeAttribute(e);break;case"string":r.setAttribute(e,o);break;case"number":r.setAttribute(e,o.toString());break;case"object":null===o&&r.removeAttribute(e)}}n>3&&(void 0!==t[3]&&doTransform(o,t[3]),n>4&&void 0!==t[4]&&((o.host||o.cache)[t[4]]=r))}}}}function doRepeat(e,t,o){o.mode,o.mode;const n=o.viewModel;o.viewModel=t[0];o.repeatProcessor(t[1],o,t[0],o.target,t[3],t[4]);o.viewModel=n}const countKey=Symbol.for("04efa75f-dec8-4002-a091-153683691bd1"),itemsKey=Symbol.for("bb247496-9c5d-459c-8127-fe80fee8c256"),idxKey=Symbol.for("ad7cf100-0c10-4184-b836-f560f2c15c81"),ubKey=Symbol.for("7c6fd3aa-eea3-478c-b18c-32132b1bfc7c");function repeatInit(e,t,o,n,r){const s=o.length;n[countKey]=s,n[ubKey]=s;const a=Object.assign({},t);a.Transform="symbol"==typeof r?a[r]:r;for(let t=0;t<s;t++){const r=o[t];a.item=r,a.idx=t,a.itemTagger=e=>{e[idxKey]=t,e[itemsKey]=r},isTemplate(e)?transform(e,a,n):renderDynamicContent(e,a,n)}}function renderDynamicContent(e,t,o){switch(typeof e){case"string":const n=document.createElement(e);o.appendChild(n);const r=Object.assign({},t);r.target=n,"function"==typeof r.Transform&&(r.Transform=r.Transform(r)),processEl(r);break;case"object":transform(e,t,o);break;case"function":renderDynamicContent(e(t),t,o)}}const origStyleKey=Symbol("origStyle");function repeatethUpdateth(e,t,o,n,r){const s=n[countKey],a=o.length,i=n[ubKey];console.log(n.dataset);const c=a-s,l=Object.assign({},t);l.Transform="symbol"==typeof r?t[r]:r;for(let e=0;e<Math.max(s,a);e++){const t=o[e];l.item=t,l.idx=e;const r=n.children[e];l.target=r,"function"==typeof l.Transform?l.Transform(l):processEl(l)}if(c>0){for(let t=0;t<c;t++){const r=t+s,a=o[r];if(l.item=a,l.idx=r,t+s<i){const e=n.children[t+s];e.style.display=e[origStyleKey]}else l.itemTagger=e=>{e[idxKey]=r,e[itemsKey]=a},isTemplate(e)?transform(e,l,n):renderDynamicContent(e,l,n)}n[ubKey]=s+c}else for(let e=n.children.length-1;e>-1;e--){const t=n.children[e];t[idxKey]>=a&&(t[origStyleKey]=t.style.display,t.style.display="none")}n[countKey]=a}const initialized=Symbol();function repeateth(e,t,o,n,r,s=r){void 0!==n[initialized]?repeatethUpdateth(e,t,o,n,s):(repeatInit(e,t,o,n,r),n[initialized]=!0)}const sk=Symbol("sk");function interpolate(e,t,o,n=!1){let r=e[sk];if(void 0===r){r=(n?e.getAttribute(t):e[t]).split("|"),e[sk]=r.map(e=>{const t=e.split("??");return 1===t.length?t[0]:t})}const s=e[sk].map((e,t)=>{const n=Array.isArray(e),r=n?e[0]:e;if("."===r[0]){const t=o[r.substr(1).trim()];return n&&null==t?e[1]:t}return t%2==1?"|"+r+"|":r}).join("");n?e.setAttribute(t,s):e[t]=s}const interpolateSym=Symbol.for("+QWTsLO6pUq7e0dxjginwg");function fromTuple(e,t){let o=t[2];if(Array.isArray(o))o=getProp(e,o);else switch(typeof t[2]){case"function":o=o(e,t)}interpolate(e.target,t[1],o,t[3])}const plugin={fn:fromTuple,sym:interpolateSym};export{doObjectMatch,plugin as interpolatePlugin,interpolateSym,repeateth};